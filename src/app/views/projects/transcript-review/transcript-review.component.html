<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <div class="d-flex align-items-center">
          <svg cIcon name="cilNotes" class="me-2"></svg>
          <strong>Step 4: Transcript Review & Insight Extraction</strong>
        </div>
      </c-card-header>
      <c-card-body>
        <c-row>
          <c-col md="7">
            <h5 class="mb-3">Conversation Transcript</h5>
            <textarea
              cFormControl
              rows="20"
              readonly
              class="bg-light mb-3"
              style="resize: none; font-family: monospace;"
              [value]="transcript()"
            ></textarea>
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <svg cIcon name="cilInfo" size="sm" class="me-1"></svg>
                Review and edit the transcript if needed
              </small>
              <button cButton color="secondary" variant="outline" size="sm">
                <svg cIcon name="cilPencil" class="me-1"></svg>
                Edit
              </button>
            </div>
          </c-col>

          <c-col md="5">
            <c-card class="border-0 bg-light h-100">
              <c-card-body>
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h5 class="card-title text-primary mb-0">
                    <svg cIcon class="me-2" name="cilLightbulb"></svg>
                    AI Analysis
                  </h5>
                  <button
                    cButton
                    color="primary"
                    size="sm"
                    (click)="analyze()"
                    [disabled]="isAnalyzing() || showInsights()"
                  >
                    @if (isAnalyzing()) {
                      <c-spinner size="sm" class="me-2"></c-spinner>
                      Analyzing...
                    } @else {
                      Analyze with AI
                    }
                  </button>
                </div>

                @if (showInsights()) {
                  <div class="mb-4">
                    <h6 class="mb-3">Extracted Insights</h6>
                    @for (insight of insights(); track insight.title) {
                      <c-alert [color]="getInsightColor(insight.type)" class="mb-3">
                        <div class="d-flex align-items-start">
                          <svg
                            cIcon
                            [name]="insight.type === 'Pain Point' ? 'cilWarning' : insight.type === 'Opportunity' ? 'cilCheckCircle' : 'cilLightbulb'"
                            class="me-2 mt-1"
                          ></svg>
                          <div class="flex-grow-1">
                            <h6 class="alert-heading mb-1">{{ insight.title }}</h6>
                            <p class="mb-0 small">{{ insight.description }}</p>
                          </div>
                        </div>
                      </c-alert>
                    }
                  </div>

                  <div class="d-grid mt-4">
                    <button cButton color="primary" (click)="generatePrompt()">
                      Generate Research Prompt
                      <svg cIcon class="ms-2" name="cilArrowRight"></svg>
                    </button>
                  </div>
                } @else if (!isAnalyzing()) {
                  <div class="text-center text-muted mt-5">
                    <svg cIcon name="cilLightbulb" size="3xl" class="mb-3"></svg>
                    <p>Click "Analyze with AI" to extract key insights from the transcript.</p>
                    <small>The AI will identify pain points, opportunities, and strategic insights.</small>
                  </div>
                }
              </c-card-body>
            </c-card>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

