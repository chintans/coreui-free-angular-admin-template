<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>Step 4: Transcript Review & Insight Extraction</strong>
      </c-card-header>
      <c-card-body>
        <c-row>
          <c-col md="7">
            <h5 class="mb-3">Conversation Transcript</h5>
            <textarea cFormControl rows="15" readonly class="bg-light mb-3" style="resize: none;">{{ transcript }}</textarea>
          </c-col>

          <c-col md="5">
            <c-card class="border-0 bg-light h-100">
              <c-card-body>
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h5 class="card-title text-primary mb-0">
                    <svg cIcon class="me-2" name="cilLightbulb"></svg>
                    AI Analysis
                  </h5>
                  <button cButton color="primary" (click)="analyze()" [disabled]="isAnalyzing || showInsights">
                    @if (isAnalyzing) {
                      <c-spinner size="sm" class="me-2"></c-spinner>
                      Analyzing...
                    } @else {
                      Analyze with AI
                    }
                  </button>
                </div>

                @if (showInsights) {
                  @for (insight of insights; track insight.title) {
                    <c-alert color="success" class="mb-3">
                      <h6 class="alert-heading">{{ insight.title }}</h6>
                      <p class="mb-0 small">{{ insight.description }}</p>
                    </c-alert>
                  }

                  <div class="d-grid mt-4">
                    <button cButton color="primary" (click)="generatePrompt()">
                      Generate Research Prompt
                      <svg cIcon class="ms-2" name="cilArrowRight"></svg>
                    </button>
                  </div>
                } @else if (!isAnalyzing) {
                  <div class="text-center text-muted mt-5">
                    <p>Click "Analyze with AI" to extract key insights from the transcript.</p>
                  </div>
                }
              </c-card-body>
            </c-card>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>
