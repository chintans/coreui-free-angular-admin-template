@if (contractor(); as contractorData) {
  <c-row class="mb-4">
    <c-col xs="12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <button cButton color="link" [routerLink]="['/marketplace']" class="mb-2">
            <svg cIcon name="cilArrowLeft" class="me-2"></svg>
            Back to Marketplace
          </button>
          <h2 class="mb-0">{{ contractorData.name }}</h2>
        </div>
        @if (isSuperAdmin()) {
          <div class="d-flex gap-2">
            <button cButton color="primary" (click)="onEdit()">
              <svg cIcon name="cilPencil" class="me-2"></svg>
              Edit
            </button>
            <button cButton color="danger" variant="outline" (click)="onDelete()">
              <svg cIcon name="cilTrash" class="me-2"></svg>
              Delete
            </button>
          </div>
        }
      </div>
    </c-col>
  </c-row>

  <c-row>
    <c-col xs="12" lg="4">
      <c-card class="mb-4">
        <c-card-body class="text-center">
          @if (contractorData.avatar) {
            <c-avatar
              [src]="'./assets/images/avatars/' + contractorData.avatar"
              size="xxl"
              class="mb-3"
            ></c-avatar>
          } @else {
            <div
              class="d-inline-flex align-items-center justify-content-center rounded-circle bg-primary text-white mb-3"
              style="width: 120px; height: 120px; font-size: 3rem; font-weight: bold;"
            >
              {{ contractorData.name.charAt(0) }}
            </div>
          }
          <h4 class="mb-2">{{ contractorData.name }}</h4>
          <c-badge
            [color]="contractorData.type === 'Agency' ? 'primary' : 'success'"
            class="mb-3"
          >
            {{ contractorData.type }}
          </c-badge>
          @if (contractorData.description) {
            <p class="text-muted">{{ contractorData.description }}</p>
          }
          <div class="d-flex justify-content-center align-items-center gap-3 mb-3">
            <div class="d-flex align-items-center">
              <svg cIcon name="cilStar" class="text-warning me-1"></svg>
              <strong>{{ contractorData.rating }}</strong>
            </div>
          </div>
        </c-card-body>
      </c-card>

      <c-card class="mb-4">
        <c-card-header>
          <h5>Contact Information</h5>
        </c-card-header>
        <c-card-body>
          @if (contractorData.email) {
            <div class="mb-3">
              <strong>Email:</strong>
              <div>
                <a [href]="'mailto:' + contractorData.email">{{ contractorData.email }}</a>
              </div>
            </div>
          }
          @if (contractorData.phone) {
            <div class="mb-3">
              <strong>Phone:</strong>
              <div>
                <a [href]="'tel:' + contractorData.phone">{{ contractorData.phone }}</a>
              </div>
            </div>
          }
        </c-card-body>
      </c-card>
    </c-col>

    <c-col xs="12" lg="8">
      @if (contractorUser()?.contractorProfile) {
        <!-- Use Cases -->
        <c-card class="mb-4">
          <c-card-header>
            <h5>Use Cases</h5>
          </c-card-header>
          <c-card-body>
            @if (contractorUser()!.contractorProfile!.useCases && contractorUser()!.contractorProfile!.useCases!.length > 0) {
              <div class="d-flex flex-wrap gap-2">
                @for (useCase of contractorUser()!.contractorProfile!.useCases; track useCase) {
                  <c-badge color="info">{{ useCase }}</c-badge>
                }
              </div>
            } @else {
              <p class="text-muted">No use cases specified</p>
            }
          </c-card-body>
        </c-card>

        <!-- Client Testimonials -->
        <c-card class="mb-4">
          <c-card-header>
            <h5>Client Testimonials</h5>
          </c-card-header>
          <c-card-body>
            @if (contractorUser()!.contractorProfile!.clientTestimonials && contractorUser()!.contractorProfile!.clientTestimonials!.length > 0) {
              @for (testimonial of contractorUser()!.contractorProfile!.clientTestimonials; track testimonial.id) {
                <div class="mb-3 pb-3 border-bottom">
                  <div class="d-flex align-items-center mb-2">
                    <strong>{{ testimonial.clientName }}</strong>
                    @if (testimonial.clientCompany) {
                      <span class="text-muted ms-2">- {{ testimonial.clientCompany }}</span>
                    }
                    <div class="ms-auto">
                      @for (star of [1,2,3,4,5]; track star) {
                        <svg cIcon [name]="star <= testimonial.rating ? 'cilStar' : 'cilStar'" 
                             [class.text-warning]="star <= testimonial.rating" 
                             [class.text-muted]="star > testimonial.rating"
                             size="sm"></svg>
                      }
                    </div>
                  </div>
                  <p class="mb-0">{{ testimonial.testimonial }}</p>
                  @if (testimonial.date) {
                    <small class="text-muted">{{ testimonial.date | date:'mediumDate' }}</small>
                  }
                </div>
              }
            } @else {
              <p class="text-muted">No testimonials yet</p>
            }
          </c-card-body>
        </c-card>

        <!-- Recent Work -->
        <c-card class="mb-4">
          <c-card-header>
            <h5>Recent Work</h5>
          </c-card-header>
          <c-card-body>
            @if (contractorUser()!.contractorProfile!.recentWork && contractorUser()!.contractorProfile!.recentWork!.length > 0) {
              @for (work of contractorUser()!.contractorProfile!.recentWork; track work.id) {
                <div class="mb-3 pb-3 border-bottom">
                  <h6>{{ work.title }}</h6>
                  @if (work.clientName) {
                    <p class="text-muted small mb-1">Client: {{ work.clientName }}</p>
                  }
                  <p class="mb-1">{{ work.description }}</p>
                  <div class="d-flex gap-2">
                    @if (work.category) {
                      <c-badge color="secondary">{{ work.category }}</c-badge>
                    }
                    @if (work.completedDate) {
                      <small class="text-muted">{{ work.completedDate | date:'mediumDate' }}</small>
                    }
                  </div>
                </div>
              }
            } @else {
              <p class="text-muted">No recent work listed</p>
            }
          </c-card-body>
        </c-card>

        <!-- Portfolio -->
        <c-card class="mb-4">
          <c-card-header>
            <h5>Portfolio</h5>
          </c-card-header>
          <c-card-body>
            @if (contractorUser()!.contractorProfile!.portfolio && contractorUser()!.contractorProfile!.portfolio!.length > 0) {
              <c-row>
                @for (item of contractorUser()!.contractorProfile!.portfolio; track item.id) {
                  <c-col xs="12" md="6" class="mb-3">
                    <c-card>
                      @if (item.imageUrl) {
                        <img [src]="item.imageUrl" class="card-img-top" [alt]="item.title" style="height: 200px; object-fit: cover;">
                      }
                      <c-card-body>
                        <h6>{{ item.title }}</h6>
                        <p class="small text-muted">{{ item.description }}</p>
                        @if (item.tags && item.tags.length > 0) {
                          <div class="mb-2">
                            @for (tag of item.tags; track tag) {
                              <c-badge color="info" class="me-1 mb-1">{{ tag }}</c-badge>
                            }
                          </div>
                        }
                        @if (item.link) {
                          <a [href]="item.link" target="_blank" cButton color="primary" size="sm">
                            View Project
                          </a>
                        }
                      </c-card-body>
                    </c-card>
                  </c-col>
                }
              </c-row>
            } @else {
              <p class="text-muted">No portfolio items yet</p>
            }
          </c-card-body>
        </c-card>
      }

      <c-card class="mb-4">
        <c-card-header>
          <h5>Skills & Expertise</h5>
        </c-card-header>
        <c-card-body>
          <div class="mb-4">
            @if (contractorData.skills && contractorData.skills.length > 0) {
              <div>
                <h6 class="mb-3">Skills</h6>
                <div>
                  @for (skill of contractorData.skills; track skill) {
                    <c-badge color="info" class="me-2 mb-2">{{ skill }}</c-badge>
                  }
                </div>
              </div>
            }
          </div>
          <div>
            @if (contractorData.categories && contractorData.categories.length > 0) {
              <div>
                <h6 class="mb-3">Categories</h6>
                <div>
                  @for (category of contractorData.categories; track category) {
                    <c-badge color="secondary" class="me-2 mb-2">{{ category }}</c-badge>
                  }
                </div>
              </div>
            }
          </div>
        </c-card-body>
      </c-card>
    </c-col>
  </c-row>
} @else {
  <c-row>
    <c-col xs="12">
      <c-card>
        <c-card-body class="text-center py-5">
          <svg cIcon name="cilUser" size="3xl" class="text-muted mb-3"></svg>
          <h4>Contractor not found</h4>
          <p class="text-muted">The contractor you're looking for doesn't exist.</p>
          <button cButton color="primary" [routerLink]="['/marketplace']">
            Back to Marketplace
          </button>
        </c-card-body>
      </c-card>
    </c-col>
  </c-row>
}

